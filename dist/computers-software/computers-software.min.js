angular.module("computersSoftware.templates",["signage/signage.tpl.html"]),angular.module("signage/signage.tpl.html",[]).run(["$templateCache",function(a){a.put("signage/signage.tpl.html",'<header class="page-row">\n    <nav class="navbar navbar-static-top navbar-mega">\n        <div class="container-fluid">\n            <div class="navbar-header">\n                <p class="navbar-text lead">\n                    <strong>Floor {{computers.buildings[0].floors[0].name}}</strong>\n                </p>\n            </div>\n\n\n            <div class="navbar-header navbar-right">\n                <p class="navbar-text lead">\n                    <strong>Available Computers:</strong>\n                </p>\n                <p class="navbar-text lead">\n                    {{computers.buildings[0].available.desktops}}\n                </p>\n            </div>\n        </div>\n    </nav>\n</header>\n\n<div class="wrap page-row page-row-expanded comp-signage-body">\n    <canvas id="asset_image" class="asset-image"></canvas>\n</div>\n<footer class="page-row">\n    <nav class="navbar navbar-static-bottom navbar-mega">\n        <div class="container-fluid">\n            <div class="nav navbar-nav">\n                <p class="navbar-text">\n                    <img src="ualib-computers-qr.jpg" style="height: 50px;"/>\n\n                </p>\n                <p class="navbar-text">\n                    For computer availability in all libraries<br> visit <a href="#">www.lib.ua.edu/computers</a>\n                </p>\n            </div>\n\n            <div class="nav navbar-nav navbar-right">\n                <p class="navbar-text lead">\n                    <strong>Apple:</strong>\n                </p>\n                <p class="navbar-text">\n                    <span class="apple available"></span> available<br> <span class="apple taken"></span> taken\n                </p>\n            </div>\n            <div class="nav navbar-nav navbar-right">\n                <p class="navbar-text lead">\n                    <strong>Windows:</strong>\n                </p>\n                <p class="navbar-text">\n                    <span class="windows available"></span> available<br> <span class="windows taken"></span> taken\n                </p>\n            </div>\n\n        </div>\n    </nav>\n</footer>\n')}]),angular.module("ualib.computers.service",["ualib.computers.factory"]).service("Computers",["compSoftFactory","$timeout","$q","$rootScope",function(a,b,c,d){function e(){i?b.cancel(h):h=b(function(){f().$promise.then(function(a){j.buildings=angular.copy(a.buildings),e()})},8e3)}function f(){return g.hasOwnProperty("floor")?a.floors().get(g,function(a){return a},function(a,b,c,d){console.log("ERROR: Computers and Software"),console.log({data:a,status:b,headers:c,config:d})}):a.buildings().get(g,function(a){return a},function(a,b,c,d){console.log("ERROR: Computers and Software"),console.log({data:a,status:b,headers:c,config:d})})}var g={},h=null,i=!1,j=this;this.buildings=[],this.init=function(a){var b=c.defer();return a=angular.isDefined(a)?a:{},g=a,h&&j.cancelRefresh(),f().$promise.then(function(a){j.buildings=angular.copy(a.buildings),e(),b.resolve()}),b.promise},this.cancelRefresh=function(){}}]),angular.module("ualib.computers.factory",[]).factory("compSoftFactory",["$resource","$http",function(a,b){function c(a,b){return b=angular.isUndefined(b)?"desktops":b,a.filter(function(a){return"desktops"===b?3===a.status:0===a.available}).length}function d(a,b){return a=angular.isArray(a)?a:[a],a.concat(b)}function e(a){var b=angular.fromJson(a),d=[];return angular.forEach(b.buildings,function(a,b){for(var e=0,f=0,g=0,h=a.floors.length;h>g;g++){var i={available:{}};if(a.floors[g].hasOwnProperty("desktops")){var j=c(a.floors[g].desktops,"desktops");i.available.desktops=j,e+=j}if(a.floors[g].hasOwnProperty("laptops")){var k=c(a.floors[g].laptops,"laptops");i.available.laptops=k,f+=k}a.floors[g]=angular.extend({},a.floors[g],i)}a.available={desktops:e,laptops:f},d.push(a)}),b.buildings=d,b}var f="https://www.lib.ua.edu/softwareList/api/buildings";return{buildings:function(){return a(f,{},{get:{method:"GET",transformResponse:d(b.defaults.transformResponse,e)}})},floors:function(){return a(f+"/:building/floors/:floor",{},{get:{method:"GET",transformResponse:d(b.defaults.transformResponse,e)}})}}}]),angular.module("ualib.computers.mapsDirective",["ualib.computers.maps","ualib.computers.service"]).directive("floorMap",["$maps","Computers","$timeout","$window",function(a,b,c,d){return{restrict:"AC",link:function(b,c){b.floors.$promise.then(function(b){a.init({src:"http://www.lib.ua.edu/"+b.buildings[0].floors[0].image.url,canvas:c[0],objects:{desktops:b.buildings[0].floors[0].desktops}}).then(function(){})}),angular.element(d).bind("resize",function(){a.resizeCanvas(),a.resizeImage(),a.posImage(),a.draw()})}}}]),angular.module("ualib.computers.maps",[]).factory("loadMap",["$q",function(a){return function(b){var c=a.defer(),d=new Image;return d.onload=function(){c.resolve(d)},d.src=b,c.promise}}]).service("$maps",["$q","mapStyles",function(a,b){var c=this;this.canvas=null,this.ctx=null,this.image=null,this.changed=!1,this.prev={},this.objects={},this.margin={width:0,height:0},this.offset={width:0,height:0},this.x=0,this.y=0,this.x2=0,this.y2=0,this.width=0,this.height=0,this.scalar=.4,this.minScale=.2,this.maxScale=1.4,this.angle=0,this.setDefaults=function(){c.resizeCanvas(),c.changed=!1,c.x=0,c.y=0,c.angle=0,c.setScale(),c.resizeImage(),c.center()},this.refactor=function(a){if(a.width!==c.width){if(c.setOffset(a),c.changed){var b=c.x+(c.prev.canvas_width-c.canvas.width)/2,d=c.y+(c.prev.canvas_height-c.canvas.height)/2;b>0&&c.x+c.width<c.canvas.width-c.margin.width-c.offset.width&&(c.x=b),d>0&&c.y+c.height<c.canvas.height-c.margin.height-c.offset.height&&(c.y=d)}else c.setDefaults();c.draw()}},this.init=function(b){var d=a.defer();return b.src?(b.offset&&c.setOffset(b.offset),b.objects&&(c.objects=angular.copy(b.objects)),b.scalar&&(c.scalarOffset=b.scalar),b.yOffset&&(c.yOffset=b.yOffset),c.canvas=b.canvas,c.ctx=c.canvas.getContext("2d"),c.loadImage(b.src,b.width,b.height).then(function(){c.setDefaults(),c.draw(),d.resolve()})):d.reject("No image src given."),d.promise},this.setOffset=function(a){c.offset.width!==a.width&&(c.offset.width=a.width)},this.loadImage=function(b,d,e){var f=a.defer();return c.image=new Image,c.image.width=d,c.image.height=e,c.image.onload=function(){f.resolve()},c.image.src=b,f.promise},this.draw=function(){c.clear(),c.ctx.save(),c.y-=c.yOffset*c.scalar,c.ctx.translate(c.x,c.y),c.ctx.scale(c.scalar,c.scalar),c.ctx.translate(c.width/2,c.height/2),c.ctx.rotate(c.angle),c.ctx.translate(-c.width/2,-c.height/2),c.ctx.drawImage(c.image,0,0),c.drawObjects(),c.ctx.restore(),c.x2=c.x+c.width,c.y2=c.y+c.height},this.drawObjects=function(){if(c.objects.hasOwnProperty("desktops")){c.ctx.fillStyle=b.desktops.available.color;for(var a=0,d=c.objects.desktops.length;d>a;a++){var e=c.objects.desktops[a],f=parseInt(e.coordinates.x)-2,g=parseInt(e.coordinates.y)-5;c.ctx.save(),3!==e.status&&(c.ctx.fillStyle=b.desktops.taken.color),1===e.os?c.ctx.fillRect(f,g,13,13):2===e.os&&(f+=7,g+=7,c.ctx.beginPath(),c.ctx.arc(f,g,7,0,2*Math.PI),c.ctx.fill()),c.ctx.restore()}}},this.setScale=function(){var a=(c.canvas.width-c.margin.width-c.offset.width)/c.image.width,b=(c.canvas.height-c.margin.height-c.offset.height)/c.image.height;c.scalar=Math.min(a,b),c.scalar+=c.scalarOffset},this.clear=function(){c.ctx.clearRect(0,0,c.canvas.width,c.canvas.height)},this.resizeCanvas=function(){c.prev.canvas_width=c.canvas.width,c.prev.canvas_height=c.canvas.height,c.canvas.style.width="100%",c.canvas.style.height="100%",c.canvas.width=c.canvas.offsetWidth,c.canvas.height=c.canvas.offsetHeight},this.resizeImage=function(){c.width=c.image.width*c.scalar,c.height=c.image.height*c.scalar},this.center=function(){c.x=(c.canvas.width-c.offset.width-c.width)/2,c.y=(c.canvas.height-c.height)/2},this.scaleXY=function(a,b){c.x=a/c.canvas.width,c.y=b/c.canvas.height},this.posImage=function(){c.changed?(c.x*=c.canvas.width/c.prev.canvas_width,c.y*=c.canvas.height/c.prev.canvas_height):c.center()}}]),angular.module("ualib.computers",["ngRoute","ngResource","angular.filter","computersSoftware.templates","ualib.computers.signage"]).value("mapStyles",{desktops:{available:{shape:"fillRect",color:"#61a661"},taken:{shape:"strokeRect",color:"#eee"}}}),angular.module("ualib.computers.signage",["ualib.computers.service","ualib.computers.maps"]).config(["$routeProvider",function(a){a.when("/computers/signage/:building/:floor",{reloadOnSearch:!1,resolve:{floors:["Computers","$route",function(a,b){return a.init(b.current.params).then(function(){return!0})}]},templateUrl:"signage/signage.tpl.html",controller:"SignageCtrl"})}]).controller("SignageCtrl",["$scope","Computers",function(a,b){a.computers=b}]).directive("assetImage",["$maps","$timeout","$window",function(a,b,c){return{restrict:"AC",link:function(b,d){var e=.27,f=60,g=parseInt(b.computers.buildings[0].floors[0].name);3===g?(e=.14,f=85):2===g&&(e=.14,f=85),a.init({src:"http://www.lib.ua.edu/"+b.computers.buildings[0].floors[0].image.url,canvas:d[0],objects:{desktops:b.computers.buildings[0].floors[0].desktops},width:b.computers.buildings[0].floors[0].image.width,height:b.computers.buildings[0].floors[0].image.height,scalar:e,yOffset:f}),angular.element(c).bind("resize",function(){a.resizeCanvas(),a.setScale(),a.resizeImage(),a.posImage(),a.draw()}),b.$on("$destroy",function(){angular.element(c).unbind("resize")})}}}]);
//# sourceMappingURL=computers-software.map